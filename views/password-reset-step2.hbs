<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>OSSU | {{#if user}}Change Password{{else}}Password Reset{{/if}}</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
	<link rel="stylesheet" href="/css/modern-auth.css">
	<link rel="icon" type="image/x-icon" href="/images/ossu-logo.png">
</head>

<body>
	<div class="auth-background">
		<div class="auth-container">
			<div class="auth-header">
				<h1>{{#if user}}Change Password - Security Questions{{else}}Password Reset - Security Questions{{/if}}</h1>
			</div>
			
			{{#if errorMessage}}
				<div class="error-box">
					{{errorMessage}}
				</div>
			{{/if}}

			<form class="auth-form" method="POST" action="/password-reset-3" novalidate>
				<!-- Hidden username field -->
				<input type="hidden" name="username" value="{{username}}">
				
				<!-- Security Question 1 -->
				<div class="input-group">
					<label>{{secQ1}}</label>
					<div class="input-field with-icon">
						<i class="input-icon fas fa-question-circle"></i>
						<input type="text" 
						       id="secQ1Ans"
						       name="secQ1Ans" 
						       placeholder="Enter your answer"
						       required 
						       maxlength="30"
						       minlength="2"
						       pattern="[a-zA-Z0-9\s.,'-]+"
						       title="Security answer must be 2-30 characters long and contain only letters, numbers, spaces, and basic punctuation">
					</div>
					<div class="char-counter" id="secQ1Ans-counter">0/30</div>
				</div>

				<!-- Security Question 2 -->
				<div class="input-group">
					<label>{{secQ2}}</label>
					<div class="input-field with-icon">
						<i class="input-icon fas fa-question-circle"></i>
						<input type="text" 
						       id="secQ2Ans"
						       name="secQ2Ans" 
						       placeholder="Enter your answer"
						       required 
						       maxlength="30"
						       minlength="2"
						       pattern="[a-zA-Z0-9\s.,'-]+"
						       title="Security answer must be 2-30 characters long and contain only letters, numbers, spaces, and basic punctuation">
					</div>
					<div class="char-counter" id="secQ2Ans-counter">0/30</div>
				</div>

				<div class="input-group">
					<input type="submit" value="Continue" name="submit" class="auth-submit-btn">
				</div>
			</form>

			{{#if user}}
				<!-- Navigation for logged-in users (Change Password flow) -->
				<div class="auth-navigation">
					{{#ifCond position 'Customer'}}
						<a href="/index" class="auth-nav-link">Back to Dashboard</a>
					{{else}}
						<a href="/staff-page" class="auth-nav-link">Back to Dashboard</a>
					{{/ifCond}}
					<a href="/logout" class="auth-nav-link">Logout</a>
				</div>
			{{else}}
				<!-- Navigation for anonymous users (Forgot Password flow) -->
				<div class="auth-navigation">
					<a href="/" class="auth-nav-link">Back to Home</a>
					<a href="/staff-login" class="auth-nav-link">Remember your password? Login</a>
				</div>
			{{/if}}
		</div>
	</div>

	<script src="/js/validation.js"></script>

	<script>
		document.addEventListener("DOMContentLoaded", function () {

			// Character counters for all inputs
			const inputs = [
				{ input: 'secQ1Ans', counter: 'secQ1Ans-counter' },
				{ input: 'secQ2Ans', counter: 'secQ2Ans-counter' }
			];

			inputs.forEach(item => {
				const inputElement = document.getElementById(item.input);
				const counterElement = document.getElementById(item.counter);
				
				if (inputElement && counterElement) {
					inputElement.addEventListener('input', function() {
						const length = this.value.length;
						const maxLength = this.getAttribute('maxlength');
						counterElement.textContent = `${length}/${maxLength}`;
						
						if (length > maxLength * 0.8) {
							counterElement.className = 'char-counter warning';
						} else if (length > maxLength * 0.9) {
							counterElement.className = 'char-counter danger';
						} else {
							counterElement.className = 'char-counter';
						}
					});
				}
			});
		});
	</script>

</body>
</html>
